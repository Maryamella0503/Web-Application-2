{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="my-4">{{ user.username }}'s Dashboard</h2>

    <!-- User Info Section -->
    <div id="user-info" class="mb-4">
        <h4>User Information</h4>
        <ul class="list-group">
            <li class="list-group-item"><strong>Phone Number:</strong> {{ user.phone_number or 'N/A' }}</li>
            <li class="list-group-item"><strong>Home Address:</strong> {{ user.home_address or 'N/A' }}</li>
            <li class="list-group-item"><strong>Work Address:</strong> {{ user.work_address or 'N/A' }}</li>
            <li class="list-group-item"><strong>Emergency Contact:</strong> {{ user.emergency_contact or 'N/A' }}</li>
        </ul>
        <button id="edit-btn" class="btn btn-primary mt-3">Edit</button>
    </div>

    <!-- Edit User Info Form -->
    <form id="edit-form" method="POST" action="{{ url_for('views.update_user_info') }}" class="mb-4" style="display: none;">
        <h4>Edit Information</h4>
        <div class="mb-3">
            <label for="phone_number" class="form-label">Phone Number:</label>
            <input type="text" class="form-control" id="phone_number" name="phone_number" value="{{ user.phone_number or '' }}">
        </div>
        <div class="mb-3">
            <label for="home_address" class="form-label">Home Address:</label>
            <input type="text" class="form-control" id="home_address" name="home_address" value="{{ user.home_address or '' }}">
        </div>
        <div class="mb-3">
            <label for="work_address" class="form-label">Work Address:</label>
            <input type="text" class="form-control" id="work_address" name="work_address" value="{{ user.work_address or '' }}">
        </div>
        <div class="mb-3">
            <label for="emergency_contact" class="form-label">Emergency Contact:</label>
            <input type="text" class="form-control" id="emergency_contact" name="emergency_contact" value="{{ user.emergency_contact or '' }}">
        </div>
        <button type="submit" class="btn btn-success">Save Changes</button>
        <button type="button" id="cancel-edit" class="btn btn-secondary">Cancel</button>
    </form>

    <!-- Crime Preferences Section -->
    <form id="crime-preferences-form" method="POST" action="{{ url_for('views.update_preferences') }}" class="mb-4">
        <h4>Preferred Crime Types</h4>
        {% set crime_types = [
            "Robbery", "Assault", "Burglary", "Vehicle Crime", "Shoplifting",
            "Antisocial Behaviour", "Arson", "Public Order", "Drugs"
        ] %}
        {% for crime in crime_types %}
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="crime_preferences" value="{{ crime }}" id="crime-{{ crime|lower|replace(' ', '-') }}" 
                   {% if user.crime_preferences and crime in user.crime_preferences %}checked{% endif %}>
            <label class="form-check-label" for="crime-{{ crime|lower|replace(' ', '-') }}">{{ crime }}</label>
        </div>
        {% endfor %}
        <button type="submit" class="btn btn-success mt-3">Save Preferences</button>
    </form>

</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const editButton = document.getElementById("edit-btn");
        const userInfo = document.getElementById("user-info");
        const editForm = document.getElementById("edit-form");
        const cancelEditButton = document.getElementById("cancel-edit");

        editButton.addEventListener("click", function() {
            editForm.style.display = "block";
            userInfo.style.display = "none";
        });

        cancelEditButton.addEventListener("click", function() {
            editForm.style.display = "none";
            userInfo.style.display = "block";
        });
    });
</script>
{% endblock %}